<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>Padrino - Padrino 0.9.25 - Slim and Erubis, Caching, and Fixes</title><link href="../../images/favicons/apple-touch-icon-57x57-75d6516e.png" rel="apple-touch-icon" sizes="57x57" /><link href="../../images/favicons/apple-touch-icon-60x60-76221479.png" rel="apple-touch-icon" sizes="60x60" /><link href="../../images/favicons/apple-touch-icon-72x72-7bd96522.png" rel="apple-touch-icon" sizes="72x72" /><link href="../../images/favicons/apple-touch-icon-76x76-30739e4d.png" rel="apple-touch-icon" sizes="76x76" /><link href="../../images/favicons/apple-touch-icon-114x114-1b1963ee.png" rel="apple-touch-icon" sizes="114x114" /><link href="../../images/favicons/apple-touch-icon-144x144-b3992622.png" rel="apple-touch-icon" sizes="144x144" /><link href="../../images/favicons/apple-touch-icon-152x152-48259d13.png" rel="apple-touch-icon" sizes="152x152" /><link href="../../images/favicons/apple-touch-icon-180x180-b8e9ebf6.png" rel="apple-touch-icon" sizes="180x180" /><link href="../../images/favicons/favicon-32x32-c7d41b6f.png" rel="icon" sizes="32x32" type="image/png" /><link href="../../images/favicons/favicon-194x194-a2b53f7f.png" rel="icon" sizes="194x194" type="image/png" /><link href="../../images/favicons/favicon-96x96-1f5cec29.png" rel="icon" sizes="96x96" type="image/png" /><link href="../../images/favicons/android-chrome-192x192-a15741d5.png" rel="icon" sizes="192x192" type="image/png" /><link href="../../images/favicons/favicon-16x16-609a9b93.png" rel="icon" sizes="16x16" type="image/png" /><link href="../../images/favicons/manifest.json" rel="manifest" /><link color="#5bbad5" href="../../images/favicons/safari-pinned-tab-a188e924.svg" rel="mask-icon" /><link href="/images/favicons/favicon.ico" rel="shortcut icon" /><meta content="#da532c" name="msapplication-TileColor" /><meta content="../../images/favicons/mstile-144x144-c2018144.png" name="msapplication-TileImage" /><meta content="/images/favicons/browserconfig.xml" name="msapplication-config" /><meta content="#ffffff" name="theme-color" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><link href="../../assets/stylesheets/all-072dd7ac.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script><script src="../../assets/javascripts/all-956a861e.js"></script><link href="http://padrinorb.com/blog.rss" rel="alternate" title="Blog - Padrino Ruby Web Framework" type="application/rss+xml" /></head><body class="blog blog_padrino-0-9-25-slim-and-erubis-caching-and-fixes blog_padrino-0-9-25-slim-and-erubis-caching-and-fixes_index"><div class="grid"><header class="header"><h1 class="header__name"><a class="padrino-name" href="/">Padrino</a></h1><div class="header__navigation"><nav class="navigation"><a class="navigation__toggler" href="#" id="navigation__toggler"><span class="navigation__toggler__icon fa fa-navicon"></span></a><ul class="navigation__items" id="navigation__items"><li class="navigation__item"><a class="navigation__link" href="/">Overview</a></li><li class="navigation__item"><a class="navigation__link" href="/guides/">Guides</a></li><li class="navigation__item"><a class="navigation__link--is-active" href="/blog/">Blog</a></li><li class="navigation__item"><a class="navigation__link" href="http://www.rubydoc.info/github/padrino/padrino-framework">API</a></li><li class="navigation__item"><a class="navigation__link" href="/contribute/">Contribute</a></li><li class="navigation__item"><a class="navigation__link" href="https://github.com/padrino/padrino-framework"><span class="button--slim">GitHub</span></a></li></ul></nav></div></header><div class="page"><div class="page__sidebar"><div class="sidebar"><h4 class="sidebar__header--first">Blog</h4><h5 class="sidebar__header">Latest Posts</h5><ul class="sidebar__items"><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-14-2/">Padrino 0.14.2 release</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-14-1/">Padrino 0.14.1 release</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-14-0-2/">Padrino 0.14.0.2 - small bug fixes</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-14-0-1/">Padrino 0.14.0.1 - small bug fixes</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-14-0/">Padrino 0.14.0 - cascading option for Rack applications, no ruby default encodings, erubi support, bug fixes</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-13-3-2/">Padrino 0.13.3.2 - small fixes, documentation cleanup, enable sqlite's file to deep tree of subdirectories, caching the content_type mime type</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-13-3/">Padrino 0.13.3 - Generator changes, mailer rendering, proper URL escaping for link_to and form_tag helpers, new helper method, bug fixes</a></li></ul></div></div><div class="page__content"><div class="content"><div class="article"><h1 class="article__title">Padrino 0.9.25 - Slim and Erubis, Caching, and Fixes</h1><p class="article__metadata">Posted on April 04, 2011 by DAddYE | categories: <a href="/category/update/">update</a></p><p>Since our 0.9.23 release, we have been busy fixing bugs and resolving incompatibilities as quickly as possible. Today, we are be releasing <strong>0.9.25</strong> which brings another wave of improvements, bug fixes, and component compatibility. 0.9.25 is very likely the largest release our team has had in quite a while and as you might notice represents two version bumps in one.</p>

<p>The biggest changes with this release are the introductions of <strong>Padrino Cache</strong> (and documentation), complete support for <strong>Erubis</strong> and <strong>Slim</strong> rendering, support for <code>unobtrusive javascript handlers</code>, and a revamped routing implementation.</p>

<p>For more details, check out the rest of this post below for the feature highlights.</p>
<h2 id="padrino-cache">Padrino Cache</h2>
<p>The <a href="https://github.com/padrino/padrino-framework/tree/master/padrino-cache">padrino-cache</a> gem has had a long journey and has traditionally been the neglected and abandoned sibling in the padrino framework family.</p>

<p>This is no longer the case with this release. The padrino-cache gem has now been added as a first-class member of the Padrino framework.</p>

<p>The functionality includes a variety of caching types and stores including <strong>memcached</strong> and <strong>redis</strong> support. Adding new adapters in the future will be very easy as the gem was designed for extensibility in mind. This is the caching solution you always hoped to have when using Sinatra.</p>

<p>For more information, check out the <a href="https://github.com/padrino/padrino-framework/blob/master/padrino-cache/README.rdoc">README</a> as well as the <a href="http://www.padrinorb.com/guides/padrino-cache">Padrino Cache Guide</a> for a solid overview of this new addition to our framework.</p>

<p>Thanks to core member Joshua Hull for the majority of the caching implementation and Joshua Morris (Onethirtyfive), Arthur Chiu, and DAddYE for the Caching documentation.</p>

<p>Here&#39;s an example of the caching gem usage:</p>
<pre class="syntax plaintext"><code># app/app.rb
class Sample &lt; Padrino::Application
  register Padrino::Helpers
  register Padrino::Mailer
  register Padrino::Cache
  ...
end

# lib/awesome.rb
Padrino.cache.set(:categories, Category.all) # =&gt; this is shared between apps
Sample.cache.set(:background, Image.order("RAND()").first) # =&gt; this is used only by Sample app

# app/controllers.rb
Sample.controllers do
  get :background do
    cache.get(:background)
  end
  ...
end

# demo/controllers.rb
Demo.controllers :cache =&gt; true do
  get :foo do
    render :some_thing_longer
  end

  get :bar, :cache =&gt; false do
    Padrino.get(:categories)
  end
  ...
end
</code></pre>

<p>You can start using this now in your Padrino and Sinatra applications. Let us know what you think.</p>
<h2 id="ujs-adapters">UJS Adapters</h2>
<p>Padrino has been waiting on unobtrusive javascript handling for a while now as well. This enables support for ‘remote’ links and forms as well as setting link ‘methods’ and having the unobtrusive javascript adapters make that ‘just work’.</p>

<p>For more information on these unobtrusive javascript handlers, check out the <a href="http://www.padrinorb.com/guides/application-helpers#unobtrusive-javascript-helpers">Helpers Guide</a> which will give you a good overview of what&#39;s now available once the UJS adapter is included in your project.</p>

<p>Not all of the adapters are finished for each javascript framework yet, but we intend on getting them integrated soon. Of course, we could always <strong>use your help!</strong> jquery and prototype UJS adapters are complete but the others are only in partial states of completion.</p>

<p>Check out the <a href="https://github.com/padrino/padrino-static">padrino-static</a> project to see all of the files associated with this effort. Please fork and help us improve this adapters.</p>

<p>You can read about how to add a new javascript component or add UJS support in the <a href="http://www.padrinorb.com/guides/adding-new-components#javascript-library">Adding Components</a> guide.</p>

<p>An example code:</p>
<pre class="syntax plaintext"><code># /app/views/users/new.html.haml
- form_for :user, url(:create, :format =&gt; :js), :remote =&gt; true do |f|
  .content=partial "/users/form"
</code></pre>

<p>which will generate the following unobtrusive markup:</p>
<pre class="syntax plaintext"><code>&lt;form data-remote="true" action="../../items/create.js" method="post"&gt;
  &lt;div class="content"&gt;
    &lt;input type="text" id="post_title" name="post[title]"&gt;
    &lt;input type="submit" value="Create"&gt;
  &lt;/div&gt;
&lt;/form&gt;

# /app/controllers/users.rb
  post :create, :provides =&gt; :js do
    @user = User.new(params[:user])
    if @user.save
      "$('form.content').html('#{partial("/users/form")}');"
    else
      "alert('User is not valid');"
    end
  end
</code></pre>

<p>This feature should make javascript and ajax handling in Sinatra / Padrino easier then ever before.</p>
<h2 id="routing-enhancements">Routing Enhancements</h2>
<p>In this release, <strong>Joshua Hull</strong> has also completely rewrote <a href="https://github.com/joshbuddy/http_router">http_router</a>, the router library that powers <strong>Padrino</strong> under the hood.</p>

<p>This rewrite does <strong>not</strong> break compatibility with previous padrino releases and does not break the existing routing syntax.</p>

<p>The changes are mostly abstracted away from usage in Padrino, but the router is now leaner, faster and easier to extend.</p>

<p>Since it was designed to be more flexible, it also supports multiple named parameter captures and other things that weren&#39;t support in the previous release of Padrino.</p>

<p>Some examples:</p>
<pre class="syntax plaintext"><code># app/controllers.rb
get :show, :map =&gt; '/pictures/*path.html' do
  ...
end

get :index do
  # Generates: "/?account[name]=foo&amp;account[surname]=bar"
  url(:index, "account[name]" =&gt; "foo", "account[surname]" =&gt; "bar")
end

get "/email/:email", :format =&gt; :json do |email|
  # =&gt; foo@bar.com
  email
end
</code></pre>

<p>Our new router is still under continued development but should not cause any breaking changes when you upgrade your applications. If you run into any issues please <a href="https://github.com/padrino/padrino-framework/issues">let us know!</a>.</p>
<h2 id="erubis-and-slim-helper-support">Erubis and Slim Helper Support</h2>
<p>In the past few versions, we have had partial <a href="https://github.com/stonean/slim">Slim</a> and <a href="https://github.com/kwatch/erubis">Erubis</a> support but not full compatibility with our various helpers.</p>

<p>This was because of broken implementations of capture and concat for those template engines (<a href="https://gist.github.com/829030">described here</a>).</p>

<p>Thankfully with the help of <a href="https://github.com/kwatch">Makoto Kuwata</a> of Erubis and <a href="https://github.com/stonean">Andrew Stone</a> of Slim, and a <a href="https://github.com/rtomayko/tilt/commit/623811e72df0bc20f3e9d6925241927ff76b6f2c">couple</a> <a href="https://github.com/rtomayko/tilt/commit/e894029970498829051ab3400af2fa7ab8956e30">patches</a> to <a href="https://github.com/rtomayko/tilt">Tilt</a>, we have been able to correct this and bring about full support for our helpers in Slim and Erubis bringing them in line with the existing support for Haml and ERB. The template engines are also supported by the Padrino generator now as well.</p>

<p>As for tilt and sinatra, Erubis is the new standard engine for processing erb files. Another enhancement allows Padrino to use <strong>mixed</strong> templates combining templates and partials from multiple engines.</p>

<p>For example:</p>
<pre class="syntax plaintext"><code># views/yours.haml
%p=partial 'show/an/erb/partial.erb'

# partial.erb
&lt;%= some code in erb here %&gt;
</code></pre>

<p>This has been a tremendous effort getting these engines to work together and to provide full helper support for Slim, Erubis, ERB, and HAML. Thanks specifically to <strong>DAddYE</strong> of our core team for the implementation. Also <strong>RKH</strong> from the Sinatra team for his help.</p>
<h2 id="sessions-and-flash">Sessions and Flash</h2>
<p><code>Rack::Flash</code> is no longer dependent on rack’s default sessions, so you are able to use <code>Rack::Flash</code> with other session engines such as memcached, datamapper, mongomapper etc…</p>

<p>Unfortunately you’ll now need to update your projects to specifically enable sessions inside your <code>app.rb</code> to use <code>Rack::Flash</code>, otherwise an error will be returned.</p>
<pre class="syntax plaintext"><code>class PadrinoWeb &lt; Padrino::Application
  enable :sessions
end
</code></pre>
<h2 id="select-tag-enhancements">Select Tag Enhancements</h2>
<p>Thanks to ActiveStylus, the select tag also sports a number of improvements. You can now specify the options as a range directly:</p>
<pre class="syntax plaintext"><code>select_tag(:favorite_color, :options =&gt; (1..3))
</code></pre>

<p>or pass in a grouped options set:</p>
<pre class="syntax plaintext"><code>grouped_options = {'Friends'=&gt;['Yoda',['Obiwan',1]], 'Enemies'=&gt;['Palpatine','Vader']}
select_tag(:name, :grouped_options =&gt; grouped_options)
</code></pre>

<p>All previous select tag options should work without any breaking compatibility issues.</p>
<h2 id="secret-key-for-sessions">Secret key for sessions</h2>
<p>Now according to the new Sinatra we have a <code>session_secret</code> and rake task to generate new keys. In projects generated with <strong>Padrino 0.9.25</strong> this will be generated in your <code>app.rb</code> as default, if you upgrade from an older project you can use our rake task.</p>

<p>Some code:</p>
<pre class="syntax plaintext"><code># app/app.rb
class Sample &lt; Padrino::Application
  set :session_secret, "6ca7e9fd7b1eb5a447ae3ba55495621c9169e8ec236ef19829a7684cf86f2404"
  ...
end

# Generate a secret key
$ padrino-dev rake secret
=&gt; Executing Rake secret ...
7043bc560e73c46f0d5eabedbabd217f9f5277e6935047bb9430296ab7b47a44
</code></pre>
<h2 id="logger-improvements">Logger Improvements</h2>
<p>Our logger got several major readability enhancements and now logs <em>cache set</em> and <em>cache get</em> with the amount of time spent.</p>

<p>An example:</p>
<pre class="syntax plaintext"><code># First request
DEBUG - [08/Apr/2011 22:02:17] "MONGODB padrino_www_development['accounts'].find({:_id=&gt;nil})"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0121ms) 127.0.0.1 - - /admin/ HTTP/1.1 - 302 -"
DEBUG - [08/Apr/2011 22:02:17] "MONGODB padrino_www_development['accounts'].find({:_id=&gt;nil})"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0269ms) 127.0.0.1 - - /admin/sessions/new HTTP/1.1 - 200 1749"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0010ms) 127.0.0.1 - - /admin/stylesheets/themes/default/style.css?1268092944 HTTP/1.1 - 200 6741"
DEBUG - [08/Apr/2011 22:02:17] "MONGODB padrino_www_development['accounts'].find({:_id=&gt;nil})"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0023ms) 127.0.0.1 - - /admin/stylesheets/override.css?1302292937 HTTP/1.1 - 302 -"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0008ms) 127.0.0.1 - - /admin/stylesheets/base.css?1269259073 HTTP/1.1 - 200 4774"
DEBUG - [08/Apr/2011 22:02:17] "MONGODB padrino_www_development['accounts'].find({:_id=&gt;nil})"
DEBUG - [08/Apr/2011 22:02:17] "GET (0.0097ms) 127.0.0.1 - - /admin/sessions/new HTTP/1.1 - 200 1749"
DEBUG - [08/Apr/2011 22:02:20] "Resolving layout /src/padrino-web/app/views/layouts/application"

# Second request
DEBUG - [08/Apr/2011 22:03:10] "GET Cache (0.0002ms) /"
DEBUG - [08/Apr/2011 22:03:10] "GET (0.0083ms) 127.0.0.1 - - / HTTP/1.1 - 200 18475"
</code></pre>
<h2 id="other-significant-changes">Other significant changes</h2>
<ul>
<li>Padrino logger can now be disabled – <a href="https://github.com/padrino/padrino-framework/commit/99df83fc83f75c4da901dad23bcb7478a0e3159b">commit</a></li>
<li>Uses official mongomapper release – <a href="https://github.com/padrino/padrino-framework/commit/e777d29fe62260e3a626a892db439e2a5f98460a">commit</a></li>
<li>Fixes issue with ERB capture support in certain edge cases – <a href="https://github.com/padrino/padrino-framework/commit/ab6f2cb33d659b63702db0ce15bdec8aaa5f59db">commit</a></li>
<li>Fixes ajax jquery detection [Thanks funny-falcon!] – <a href="https://github.com/padrino/padrino-framework/commit/b1448586f1cbaa81bf6b89bc0e1624a7ad033f31">commit</a></li>
<li>Added Lib to folders to be reloaded in development – <a href="https://github.com/padrino/padrino-framework/commit/39a08b2878801cf5d8570c6ad2c5313d31a56e7e">commit</a></li>
<li>Added mounted app name to the log for debugging – <a href="https://github.com/padrino/padrino-framework/commit/a7796bd0b037c6f50d408f908e05a9e9af79bf69">commit</a></li>
<li>Fixes to Form Builder and object name generation [Thanks funny-falcon!] – <a href="https://github.com/padrino/padrino-framework/commit/99fb4a71bc9cd3c7e4c2327e35d161ba202559e3">commit</a></li>
<li>stylesheet_link_tag and javascript_include_tag (allow array input) – <a href="https://github.com/padrino/padrino-framework/pull/465">pull</a></li>
</ul>
<h2>Contribute</h2><p><Slimconsumes>Please report any issues you encounter with this release! We are working very actively on Padrino and want to make the framework as stable and reliable as possible. That concludes the changelog for this release. As always if you want to keep up with Padrino updates, be sure to follow us on twitter: <a href="https://twitter.com/padrinorb">@padrinorb</a>, join us on IRC at “#padrino” on freenode, <a href="https://github.com/padrino/padrino-framework/issues">open an issue</a>, or discuss on <a href="https://gitter.im/padrino/padrino-framework">gitter</a>.</Slimconsumes></p><hr /></div><div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'padrinorb';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>
</div></div></div><hr /><footer class="footer"><p>Padrino is released under the MIT LICENSE<br/>
Hosting by <a title="GitHub Pages" href="https://pages.github.com">GitHub Pages</a><br/>
Logo design by <a title="unpolo" href="https://www.unpolo.com/">unpolo</a></p>
<script>anchors.add('').remove('.sidebar h4, .sidebar h5, .header h1');</script></footer></div></body></html>